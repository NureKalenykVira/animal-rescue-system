<section class="admin-section">
  <h2  *ngIf="!isLocalAdmin">–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ñ –∫–ª—ñ–Ω—ñ–∫–∏</h2>
  <h2 *ngIf="isLocalAdmin">–ú–æ—è –∫–ª—ñ–Ω—ñ–∫–∞</h2>

  <!-- –ü–∞–Ω–µ–ª—å —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ -->
  <section class="filter-controls" *ngIf="!isLocalAdmin">
    <div class="filter-fields">
      <label>
        ID:
        <input type="number" [(ngModel)]="filters.id" (change)="applyFilters()" />
      </label>

      <label>
        ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
        <input type="number" [(ngModel)]="filters.adminId" (change)="applyFilters()" />
      </label>

      <label>
        –°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞:
        <select [(ngModel)]="filters.orderBy" (change)="applyFilters()">
          <option value="id">ID</option>
          <option value="name">–ù–∞–∑–≤–∞</option>
        </select>
      </label>

      <label>
        –ù–∞–ø—Ä—è–º–æ–∫:
        <select [(ngModel)]="filters.order" (change)="applyFilters()">
          <option value="asc">–ó—Ä–æ—Å—Ç–∞–Ω–Ω—è–º</option>
          <option value="desc">–°–ø–∞–¥–∞–Ω–Ω—è–º</option>
        </select>
      </label>
    </div>

    <button class="green-btn" (click)="resetFilters()">–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
  </section>

  <!-- –¢–∞–±–ª–∏—Ü—è –∫–ª—ñ–Ω—ñ–∫ -->
  <table class="admin-table" *ngIf="clinics.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>–ù–∞–∑–≤–∞</th>
        <th>–õ–æ–∫–∞—Ü—ñ—è</th>
        <th>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</th>
        <th>–ö–æ–Ω—Ç–∞–∫—Ç–∏</th>
        <th>–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏</th>
        <th>–î—ñ—ó</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of clinics">
        <td>{{ c.id }}</td>
        <td><input [(ngModel)]="c.name" /></td>
        <td class="location-cell" [title]="c.displayAddress">{{ c.displayAddress }}</td>
        <td>
          <div class="admin-info" *ngIf="isLocalAdmin">
            <img *ngIf="c.admin?.photo?.url" [src]="c.admin.photo.url" alt="–§–æ—Ç–æ" />
            <span>{{ c.admin?.first_name }} {{ c.admin?.last_name }}</span>
          </div>
          <div class="admin-info" *ngIf="!isLocalAdmin">
            <select [(ngModel)]="c.admin_id">
              <option *ngFor="let u of localAdmins" [value]="u.id">
                {{ u.first_name }} {{ u.last_name }} (ID: {{ u.id }})
              </option>
            </select>
          </div>
        </td>
        <td>
          <div class="contacts">
            <div *ngIf="c.admin?.telegram_username">Telegram: {{ c.admin.telegram_username }}</div>
            <div *ngIf="c.admin?.viber_phone">Viber: {{ c.admin.viber_phone }}</div>
            <div *ngIf="c.admin?.whatsapp_phone">WhatsApp: {{ c.admin.whatsapp_phone }}</div>
          </div>
        </td>
        <td>
          {{ c.employees_count }}
          <button class="icon-button" (click)="openEmployeesModal(c)">üë•</button>
        </td>
        <td class="actions-cell">
          <button class="btn-save" (click)="saveClinic(c)">üíæ</button>
          <button *ngIf="!isLocalAdmin" class="btn-delete" (click)="openDeleteModal(c)">üóë</button>
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="clinics.length === 0">–ö–ª—ñ–Ω—ñ–∫ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>
  <button *ngIf="!isLocalAdmin" class="floating-add-btn" (click)="openAddModal()" title="–î–æ–¥–∞—Ç–∏ –∫–ª—ñ–Ω—ñ–∫—É">+</button>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
<div class="modal-overlay" *ngIf="clinicToDelete">
  <div class="modal">
    <h3>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h3>
    <p>–í–∏ —Å–ø—Ä–∞–≤–¥—ñ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–ª—ñ–Ω—ñ–∫—É "{{ clinicToDelete.name }}"?</p>
    <div class="modal-buttons">
      <button (click)="confirmDelete()">–¢–∞–∫, –≤–∏–¥–∞–ª–∏—Ç–∏</button>
      <button (click)="cancelDelete()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–ª—ñ–Ω—ñ–∫–∏ -->
<div class="modal-overlay" *ngIf="isAddModalOpen">
  <div class="modal large">
    <h3>–î–æ–¥–∞—Ç–∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—É –∫–ª—ñ–Ω—ñ–∫—É</h3>

    <label>–ù–∞–∑–≤–∞:</label>
    <input [(ngModel)]="newClinic.name" />

    <label>ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
    <input type="number" [(ngModel)]="newClinic.admin_id" />

    <div class="map-container">
      <div #addClinicMap class="map" style="height: 300px;"></div>
    </div>
    <p *ngIf="newClinic.address">–û–±—Ä–∞–Ω–∞ –∞–¥—Ä–µ—Å–∞: {{ newClinic.address }}</p>

    <div class="modal-buttons">
      <button (click)="createClinic()">–î–æ–¥–∞—Ç–∏</button>
      <button (click)="cancelAdd()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ –∫–ª—ñ–Ω—ñ–∫–∏ -->
<div class="modal-overlay" *ngIf="isEmployeesModalOpen">
  <div class="modal large">
    <h3>–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏ –∫–ª—ñ–Ω—ñ–∫–∏ #{{ selectedClinic?.id }}</h3>

    <div *ngIf="selectedEmployees.length > 0; else emptyBlock">
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>–Ü–º‚Äô—è</th>
            <th>–ö–æ–Ω—Ç–∞–∫—Ç–∏</th>
            <th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of selectedEmployees">
            <td>{{ e.id }}</td>
            <td>{{ e.first_name }} {{ e.last_name }}</td>
            <td>
              <div *ngIf="e.telegram_username">Telegram: {{ e.telegram_username }}</div>
              <div *ngIf="e.viber_phone">Viber: {{ e.viber_phone }}</div>
              <div *ngIf="e.whatsapp_phone">WhatsApp: {{ e.whatsapp_phone }}</div>
            </td>
            <td class="actions-cell">
              <button (click)="removeEmployee(e.id)">üóë</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #emptyBlock>
      <p>–ù–µ–º–∞—î –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤.</p>
    </ng-template>

    <div class="add-employee-form">
      <label>Email –Ω–æ–≤–æ–≥–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞:</label>
      <input [(ngModel)]="newEmployeeEmail" type="email" />
      <button (click)="addEmployee()">–î–æ–¥–∞—Ç–∏</button>
    </div>

    <div class="modal-buttons">
      <button (click)="closeEmployeesModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>
</div>
