<app-site-header></app-site-header>

<main class="animal-profile-container">
  <!-- –î–ª—è –≤–æ–ª–æ–Ω—Ç–µ—Ä–∞ —Ç–∞ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞ -->
  <ng-container *ngIf="canEdit && animal && animalForm; else readOnlyBlock">
    <div class="admin-layout">
      <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –¥–∞–Ω—ñ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω—É -->
      <div class="admin-left">
        <h2>–î–∞–Ω—ñ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω—É</h2>

        <form [formGroup]="animalForm" class="info-group">
          <label>–Ü–º‚Äô—è</label>
          <input type="text" formControlName="name" [disabled]="!isEditing" />

          <label>–ü–æ—Ä–æ–¥–∞</label>
          <input type="text" formControlName="breed" [disabled]="!isEditing" />

          <label>–°—Ç–∞—Ç—å</label>
          <select formControlName="gender" [disabled]="!isEditing">
            <option value="–î—ñ–≤—á–∏–Ω–∫–∞">–î—ñ–≤—á–∏–Ω–∫–∞</option>
            <option value="–•–ª–æ–ø—á–∏–∫">–•–ª–æ–ø—á–∏–∫</option>
            <option value="–ù–µ–≤—ñ–¥–æ–º–æ">–ù–µ–≤—ñ–¥–æ–º–æ</option>
          </select>

          <label>–î–∞—Ç–∞ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
          <input [value]="animal.foundDate" disabled />

          <label>–ú—ñ—Å—Ü–µ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
          <input [value]="animal.location" disabled />

          <label>–°—Ç–∞—Ç—É—Å</label>
          <select formControlName="status" [disabled]="!isEditing">
            <option *ngFor="let key of getStatusKeys()" [value]="key">{{ statusLabels[key] }}</option>
          </select>

          <label>–û–ø–∏—Å</label>
          <textarea formControlName="description" [disabled]="!isEditing"></textarea>
        </form>

        <h3>–ö–ª—ñ–Ω—ñ–∫–∞</h3>
        <div class="info-group">
          <label>–ù–∞–∑–≤–∞</label>
          <input [value]="animal.vetClinic?.name" disabled />
          <label>–ê–¥—Ä–µ—Å–∞</label>
          <input [value]="animal.vetClinic?.address" disabled />
          <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input [value]="animal.vetClinic?.phone" disabled />
        </div>

        <h3>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –ª—ñ–∫–∞—Ä</h3>
        <div class="info-group">
          <label>–Ü–º‚Äô—è</label>
          <input [value]="animal.responsibleUser?.name" disabled />
          <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input [value]="animal.responsibleUser?.phone" disabled />
        </div>

        <h3>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –≤–æ–ª–æ–Ω—Ç–µ—Ä</h3>
        <div class="info-group">
          <label>–Ü–º‚Äô—è</label>
          <input [value]="animal.responsibleVolunteer?.name" disabled />
          <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input [value]="animal.responsibleVolunteer?.phone" disabled />
        </div>

        <div class="form-buttons" *ngIf="animalForm">
          <button *ngIf="!isEditing" class="green full-width" type="button" (click)="startEdit()">–ó–º—ñ–Ω–∏—Ç–∏</button>
          <button *ngIf="isEditing" class="grey full-width" type="button" (click)="saveChanges()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ ‚Äî —Ñ–æ—Ç–æ + –ª—ñ–∫—É–≤–∞–Ω–Ω—è -->
      <div class="admin-right">
        <div class="photo-wrapper">
          <img [src]="photoPreview || 'assets/img/animal-default.jpg'"
               alt="–§–æ—Ç–æ —Ç–≤–∞—Ä–∏–Ω–∏"
               width="400" height="400" style="object-fit: cover; border-radius: 8px;" />
          <label class="admin-upload-btn" *ngIf="canEdit && !isEditing">
            –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ / –∑–º—ñ–Ω–∏—Ç–∏ —Ñ–æ—Ç–æ
            <input type="file" accept="image/*" (change)="onPhotoSelected($event)" hidden />
          </label>
        </div>

        <form [formGroup]="treatmentForm" (ngSubmit)="addTreatment()" class="treatment-form">
          <h3>–î–æ–¥–∞—Ç–∏ –ª—ñ–∫—É–≤–∞–Ω–Ω—è</h3>

          <label>–û–ø–∏—Å –ª—ñ–∫—É–≤–∞–Ω–Ω—è</label>
          <textarea formControlName="description" [disabled]="!canEdit"></textarea>

          <label>–í–∏—Ç—Ä–∞—Ç–∏ (–≥—Ä–Ω)</label>
          <input type="number" step="0.01" formControlName="moneySpent" [disabled]="!canEdit" />

          <button type="submit" class="green-add">–î–æ–¥–∞—Ç–∏</button>
        </form>

        <h3>–Ü—Å—Ç–æ—Ä—ñ—è —Ç–≤–∞—Ä–∏–Ω–∏</h3>
        <ul class="treatment-history">
          <li *ngFor="let report of treatmentReports">
            {{ report.created_at }} ‚Äî {{ report.description }} ({{ report.money_spent }} –≥—Ä–Ω)
          </li>
        </ul>
      </div>
    </div>
  </ng-container>

  <!-- –î–ª—è –∑–≤–∏—á–∞–π–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
  <ng-template #readOnlyBlock>
    <section class="animal-section" *ngIf="animal as a">
      <div class="animal-photo">
        <img [src]="photoPreview || 'assets/img/animal-default.jpg'" alt="–§–æ—Ç–æ —Ç–≤–∞—Ä–∏–Ω–∏" />
      </div>
      <div class="animal-info">
        <h1>–ü—Ä–∏–≤—ñ—Ç! –ú–µ–Ω–µ –∑–≤–∞—Ç–∏ {{ a.name }}</h1>
        <p>
          –Ø ‚Äî {{ a.breed ? a.breed : '—Ç–≤–∞—Ä–∏–Ω–∫–∞' }}. –ú–µ–Ω–µ –∑–Ω–∞–π—à–ª–∏ {{ animal.foundDate }}, —ñ –∑–∞—Ä–∞–∑ —è {{ statusText }}.
        </p>
        <p>
          –ú–µ–Ω—ñ –¥—É–∂–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–≤–æ—è —Ç—É—Ä–±–æ—Ç–∞ ‚Äî —Ç–∏ –º–æ–∂–µ—à —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞ –º–æ—î—é —ñ—Å—Ç–æ—Ä—ñ—î—é, –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∞–±–æ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏—Ö–∏—Å—Ç–∏—Ç–∏ –º–µ–Ω–µ üíö
        </p>
        <div class="qr-container" style="margin-top: 1rem;">
          <h3>QR-–∫–æ–¥ –ø—Ä–æ—Ñ—ñ–ª—é</h3>
          <div id="qrCode"></div>
        </div>
        <button
          [disabled]="!isAuthenticated"
          [class.disabled]="isFollowing || !isAuthenticated"
          class="green full-width"
          (click)="toggleFollow()">
          {{ isFollowing ? '–ü–µ—Ä–µ—Å—Ç–∞—Ç–∏ —Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏ –∑–∞ —Ç–≤–∞—Ä–∏–Ω–æ—é' : '–°—Ç–µ–∂–∏—Ç–∏ –∑–∞ —Ç–≤–∞—Ä–∏–Ω–æ—é' }}
        </button>
        <h3>–Ü—Å—Ç–æ—Ä—ñ—è –ª—ñ–∫—É–≤–∞–Ω–Ω—è</h3>
        <ul class="treatment-history styled">
          <li *ngFor="let report of treatmentReports">
            <div class="treatment-entry">
              <span class="treatment-date">{{ report.created_at }}</span>
              <span class="treatment-desc">{{ report.description }}</span>
              <span class="treatment-cost">{{ report.money_spent }} –≥—Ä–Ω</span>
            </div>
          </li>
        </ul>
      </div>
    </section>
  </ng-template>
</main>

<app-site-footer></app-site-footer>
