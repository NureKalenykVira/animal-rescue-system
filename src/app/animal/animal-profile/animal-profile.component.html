<app-site-header></app-site-header>

<main class="animal-profile-container">
  <!-- –î–ª—è –≤–æ–ª–æ–Ω—Ç–µ—Ä–∞ —Ç–∞ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞ -->
  <ng-container *ngIf="canEdit; else readOnlyBlock">
    <div class="admin-layout">
    <!-- üîπ –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –¥–∞–Ω—ñ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω—É -->
    <div class="admin-left">
      <h2>–î–∞–Ω—ñ –ø—Ä–æ —Ç–≤–∞—Ä–∏–Ω—É</h2>

      <div class="info-group">
        <label>–Ü–º‚Äô—è</label>
        <ng-container *ngIf="isEditing; else viewName">
          <input type="text" formControlName="name" />
        </ng-container>
        <ng-template #viewName>
          <input [value]="animal.name" disabled />
        </ng-template>

        <label>–ù–∞–∑–≤–∞</label>
        <ng-container *ngIf="isEditing; else viewBreed">
          <input type="text" formControlName="breed" />
        </ng-container>
        <ng-template #viewBreed>
          <input [value]="animal.breed" disabled />
        </ng-template>

        <label>–°—Ç–∞—Ç—å</label>
        <ng-container *ngIf="isEditing; else viewGender">
          <select formControlName="gender">
            <option value="–î—ñ–≤—á–∏–Ω–∫–∞">–î—ñ–≤—á–∏–Ω–∫–∞</option>
            <option value="–•–ª–æ–ø—á–∏–∫">–•–ª–æ–ø—á–∏–∫</option>
            <option value="–ù–µ–≤—ñ–¥–æ–º–æ">–ù–µ–≤—ñ–¥–æ–º–æ</option>
          </select>
        </ng-container>
        <ng-template #viewGender>
          <input [value]="animal.gender" disabled />
        </ng-template>

        <label>–î–∞—Ç–∞ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
        <input [value]="animal.foundDate" disabled />

        <label>–ú—ñ—Å—Ü–µ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
        <input [value]="animal.location" disabled />

        <label>–°—Ç–∞—Ç—É—Å</label>
        <ng-container *ngIf="isEditing; else viewStatus">
          <select formControlName="status">
            <option [value]="0">–ù–æ–≤–æ–ø—Ä–∏–±—É–ª–∏–π</option>
            <option [value]="1">–ù–∞ –ª—ñ–∫—É–≤–∞–Ω–Ω—ñ</option>
            <option [value]="2">–ó–¥–æ—Ä–æ–≤–∏–π</option>
            <option [value]="3">–£—Å–∏–Ω–æ–≤–ª–µ–Ω–∏–π</option>
          </select>
        </ng-container>
        <ng-template #viewStatus>
          <input [value]="statusLabels[animal.status]" disabled />
        </ng-template>

        <label>–û–ø–∏—Å</label>
        <ng-container *ngIf="isEditing; else viewDescription">
          <textarea formControlName="description"></textarea>
        </ng-container>
        <ng-template #viewDescription>
          <textarea [value]="animal.description" disabled></textarea>
        </ng-template>
      </div>

      <h3>–ö–ª—ñ–Ω—ñ–∫–∞</h3>
      <div class="info-group">
        <label>–ù–∞–∑–≤–∞</label>
        <input [value]="animal.vetClinic.name" disabled />

        <label>–ê–¥—Ä–µ—Å–∞</label>
        <input [value]="animal.vetClinic.address" disabled />

        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input [value]="animal.vetClinic.phone" disabled />
      </div>

      <h3>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –ª—ñ–∫–∞—Ä</h3>
      <div class="info-group">
        <label>–Ü–º‚Äô—è</label>
        <input [value]="animal.responsibleUser.name" disabled />

        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input [value]="animal.responsibleUser.phone" disabled />
      </div>

      <h3>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –≤–æ–ª–æ–Ω—Ç–µ—Ä</h3>
      <div class="info-group">
        <label>–Ü–º‚Äô—è</label>
        <input [value]="animal.responsibleVolunteer.name" disabled />

        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input [value]="animal.responsibleVolunteer.phone" disabled />
      </div>

      <div class="form-buttons">
        <button  *ngIf="!isEditing" class="green full-width"  type="button"   (click)="startEdit()">  –ó–º—ñ–Ω–∏—Ç–∏ </button>
        <button  *ngIf="isEditing" class="grey full-width" type="button" (click)="saveChanges()" > –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏ </button>
      </div>
    </div>

    <!-- üîπ –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ ‚Äî —Ñ–æ—Ç–æ + –ª—ñ–∫—É–≤–∞–Ω–Ω—è -->
    <div class="admin-right">
      <div class="photo-wrapper">
        <img [src]="photoPreview || animal.photoUrl || 'assets/img/animal-default.jpg'"
             alt="–§–æ—Ç–æ —Ç–≤–∞—Ä–∏–Ω–∏"
             width="400" height="400" style="object-fit: cover; border-radius: 8px;" />
        <label class="admin-upload-btn" *ngIf="canEdit">
          –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ / –∑–º—ñ–Ω–∏—Ç–∏ —Ñ–æ—Ç–æ
          <input type="file" accept="image/*" (change)="onPhotoSelected($event)" hidden />
        </label>
      </div>

      <form [formGroup]="treatmentForm" (ngSubmit)="addTreatment()" class="treatment-form">
        <h3>–î–æ–¥–∞—Ç–∏ –ª—ñ–∫—É–≤–∞–Ω–Ω—è</h3>

        <label>–û–ø–∏—Å –ª—ñ–∫—É–≤–∞–Ω–Ω—è</label>
        <textarea formControlName="description" [disabled]="!canEdit"></textarea>

        <label>–í–∏—Ç—Ä–∞—Ç–∏ (–≥—Ä–Ω)</label>
        <input type="number" step="0.01" formControlName="moneySpent" [disabled]="!canEdit" />

        <button type="submit" class="green-add">–î–æ–¥–∞—Ç–∏</button>
      </form>

      <h3>–Ü—Å—Ç–æ—Ä—ñ—è —Ç–≤–∞—Ä–∏–Ω–∏</h3>
      <ul class="treatment-history">
        <li *ngFor="let report of treatmentReports">
          {{ report.created_at | date:'short' }} ‚Äî {{ report.description }} ({{ report.money_spent }} –≥—Ä–Ω)
        </li>
      </ul>
    </div>
  </div>
  </ng-container>

  <!-- –î–ª—è –∑–≤–∏—á–∞–π–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
  <ng-template #readOnlyBlock>
    <section class="animal-section">
      <div class="animal-photo">
        <img [src]="animal.photoUrl || 'assets/img/deer.jpg'" alt="–§–æ—Ç–æ —Ç–≤–∞—Ä–∏–Ω–∏" />
      </div>
      <div class="animal-info">
        <h1>–Ø ‚Äì [{{ animal.name }}]</h1>
        <p>
          –Ø ‚Äî {{ animal.gender }} {{ animal.name }}. –ú–µ–Ω–µ –∑–Ω–∞–π—à–ª–∏ {{ animal.foundDate }}
          –±—ñ–ª—è {{ animal.location }}. –ù–∞—Ä–∞–∑—ñ —è –ø–µ—Ä–µ–±—É–≤–∞—é –≤ {{ animal.center }}.
        </p>
        <p class="qr-note">
          –Ü—Å—Ç–æ—Ä—ñ—é –ª—ñ–∫—É–≤–∞–Ω–Ω—è, –∞ —Ç–∞–∫–æ–∂ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏—Ö –ª—ñ–∫–∞—Ä—ñ–≤ —Ç–∞ –≤–æ–ª–æ–Ω—Ç–µ—Ä—ñ–≤ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ qr-–∫–æ–¥–æ–º:
        </p>
        <div class="qr-wrapper">
          <img [src]="animal.qrCodeUrl || 'assets/img/qr-placeholder.png'" alt="QR-–∫–æ–¥" />
        </div>
        <button
          [disabled]="!isAuthenticated"
          [class.disabled]="isFollowing || !isAuthenticated"
          class="green full-width"
          (click)="toggleFollow()">
          {{ isFollowing ? '–ü–µ—Ä–µ—Å—Ç–∞—Ç–∏ —Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏ –∑–∞ —Ç–≤–∞—Ä–∏–Ω–æ—é' : '–°—Ç–µ–∂–∏—Ç–∏ –∑–∞ —Ç–≤–∞—Ä–∏–Ω–æ—é' }}
        </button>
      </div>
    </section>
  </ng-template>
</main>

<app-site-footer></app-site-footer>
